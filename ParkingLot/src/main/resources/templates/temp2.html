<!DOCTYPE html>
<html lang="vi">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Quản trị Bãi Đỗ Xe</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    </head>

    <body>
        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <!-- Extensions Management -->
            <div id="extensions" class="section container mt-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Quản lý Tiện ích</h2>
                    <a class="btn btn-primary btn-custom" href="/extensions/add">
                        <i class="fas fa-plus"></i> Thêm tiện ích
                    </a>
                </div>

                <div class="row">
                    <!-- Sample Extension Cards -->
                    <div class="col-md-4">
                        <div class="card p-2 mb-4">
                            <img src="https://via.placeholder.com/300x250/007bff/ffffff?text=WiFi" class="card-img-top"
                                 alt="Wifi" style="height: 250px; object-fit: cover;">
                            <div class="card-body">
                                <h5 class="card-title">WiFi Miễn Phí</h5>
                                <p>Tiện ích mới phục vụ cho bến xe</p>
                                <div class="d-flex justify-content-between">
                                    <a class="btn btn-sm btn-warning" href="/extensions/1">
                                        <i class="fas fa-edit pl-2"></i> Sửa
                                    </a>
                                    <button onclick="showDeleteModal('/api/extensions/1', 'WiFi Miễn Phí')"
                                            class="btn btn-sm btn-danger">
                                        <i class="fas fa-trash pl-2"></i> Xóa
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card p-2 mb-4">
                            <img src="https://via.placeholder.com/300x250/28a745/ffffff?text=Charging" class="card-img-top"
                                 alt="Charging" style="height: 250px; object-fit: cover;">
                            <div class="card-body">
                                <h5 class="card-title">Trạm Sạc Điện Thoại</h5>
                                <p>Tiện ích mới phục vụ cho bến xe</p>
                                <div class="d-flex justify-content-between">
                                    <a class="btn btn-sm btn-warning" href="/extensions/2">
                                        <i class="fas fa-edit pl-2"></i> Sửa
                                    </a>
                                    <button onclick="showDeleteModal('/api/extensions/2', 'Trạm Sạc Điện Thoại')"
                                            class="btn btn-sm btn-danger">
                                        <i class="fas fa-trash pl-2"></i> Xóa
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card p-2 mb-4">
                            <img src="https://via.placeholder.com/300x250/ffc107/ffffff?text=Food" class="card-img-top"
                                 alt="Food" style="height: 250px; object-fit: cover;">
                            <div class="card-body">
                                <h5 class="card-title">Khu Ẩm Thực</h5>
                                <p>Tiện ích mới phục vụ cho bến xe</p>
                                <div class="d-flex justify-content-between">
                                    <a class="btn btn-sm btn-warning" href="/extensions/3">
                                        <i class="fas fa-edit pl-2"></i> Sửa
                                    </a>
                                    <button onclick="showDeleteModal('/api/extensions/3', 'Khu Ẩm Thực')"
                                            class="btn btn-sm btn-danger">
                                        <i class="fas fa-trash pl-2"></i> Xóa
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                            Xác nhận xóa tiện ích
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center mb-3">
                            <i class="fas fa-trash-alt text-danger" style="font-size: 3rem;"></i>
                        </div>
                        <p class="text-center mb-3">
                            Bạn có chắc chắn muốn xóa tiện ích <strong id="extensionName"></strong> không?
                        </p>
                        <div class="alert alert-warning d-flex align-items-center" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <div>
                                <strong>Cảnh báo:</strong> Hành động này không thể hoàn tác!
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i> Hủy bỏ
                        </button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                            <i class="fas fa-trash me-1"></i> Xóa tiện ích
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Modal -->
        <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title" id="successModalLabel">
                            <i class="fas fa-check-circle me-2"></i>
                            Thành công
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center">
                        <i class="fas fa-check-circle text-success" style="font-size: 3rem;"></i>
                        <p class="mt-3 mb-0">Đã xóa tiện ích thành công!</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" data-bs-dismiss="modal">
                            <i class="fas fa-check me-1"></i> Đóng
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Modal -->
        <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title" id="errorModalLabel">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            Lỗi
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center">
                        <i class="fas fa-times-circle text-danger" style="font-size: 3rem;"></i>
                        <p class="mt-3 mb-0">Xóa tiện ích thất bại!</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i> Đóng
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
                                        let currentDeleteEndpoint = '';

                                        // Hiển thị modal xác nhận xóa
                                        function showDeleteModal(endpoint, extensionName) {
                                            currentDeleteEndpoint = endpoint;
                                            document.getElementById('extensionName').textContent = extensionName;
                                            const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
                                            deleteModal.show();
                                        }

                                        // Xử lý sự kiện xác nhận xóa
                                        document.getElementById('confirmDeleteBtn').addEventListener('click', function () {
                                            deleteExtension(currentDeleteEndpoint);
                                        });

                                        // Hàm xóa tiện ích
                                        function deleteExtension(endpoint) {
                                            // Ẩn modal xác nhận
                                            const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
                                            deleteModal.hide();

                                            // Hiển thị loading state
                                            const confirmBtn = document.getElementById('confirmDeleteBtn');
                                            const originalText = confirmBtn.innerHTML;
                                            confirmBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status"></span> Đang xóa...';
                                            confirmBtn.disabled = true;

                                            // API call to delete extension
                                            fetch(endpoint, {
                                                method: "DELETE",
                                            })
                                                    .then((response) => {
                                                        // Reset button state
                                                        confirmBtn.innerHTML = originalText;
                                                        confirmBtn.disabled = false;

                                                        if (response.status === 204) {
                                                            // Hiển thị modal thành công
                                                            const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                                                            successModal.show();

                                                            // Tự động reload trang sau 2 giây
                                                            setTimeout(() => {
                                                                location.reload();
                                                            }, 2000);
                                                        } else {
                                                            // Hiển thị modal lỗi
                                                            const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
                                                            errorModal.show();
                                                        }
                                                    })
                                                    .catch((error) => {
                                                        // Reset button state
                                                        confirmBtn.innerHTML = originalText;
                                                        confirmBtn.disabled = false;

                                                        console.error('Error:', error);
                                                        // Hiển thị modal lỗi
                                                        const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
                                                        errorModal.show();
                                                    });
                                        }
        </script>
    </body>

</html>